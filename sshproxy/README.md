# sshproxy

Здесь содержатся скрипты для развертывания SOCKS5 прокси-сервера. [SSH-клиент](https://www.man7.org/linux/man-pages/man1/ssh.1.html)
предоставляет встроенную возможность проксирования через опцию -D, которая легко активируется одной командой. Это позволяет
обойтись без установки и настройки дополнительных программ или служб для создания прокси-сервера.

## Настройка

### Шаг 1. Добавление хоста машины в файл инвентаризации

Откройте файл `/etc/ansible/hosts`.
Добавьте информацию о сервере, который будет использоваться в качестве прокси. Пример настройки:

```cmd
[proxy]
X.X.X.X ansible_connection=ssh ansible_ssh_user=root
```

- `X.X.X.X` — это IP-адрес будущего прокси сервера
- `ansible_connection=ssh` - говорит, что подключение к серверу будет осуществляться через ssh
- `ansible_ssh_user=root` - указывает, что подключение будет происходить под пользователем root.
 
Убедитесь, что SSH-доступ к серверу настроен корректно, и у вас есть ключи для доступа.

### Шаг 2. Установка прокси-сервера

1. На локальной машине, в папке с проектом, у вас должен быть файл deploy.yaml, который является playbook для Ansible.
Этот playbook автоматизирует процесс настройки прокси сервера.

2. Чтобы запустить установку прокси-сервера на удаленной машине, выполните команду:

```cmd
ansible-playbook deploy.yaml
```

Что делает playbook:

- Создает нового пользователя sshproxy, который будет использоваться для работы прокси;
- Генерирует SSH-ключ для пользователя sshproxy и добавляет его на сервер, чтобы обеспечить доступ без пароля;
- Копирует файл службы sshproxy.service в системные файлы сервера (/etc/systemd/system);
- Активирует и запускает службу, которая будет поддерживать прокси-сервер на порту 18080.

### Шаг 3. Проверка службы

Убедитесь, что служба sshproxy работает корректно на сервере. Для этого можно выполнить команду:

```cmd
sudo systemctl status sshproxy
```

Служба должна быть активной и находиться в состоянии "running".

Теперь, когда сервер настроен и служба запущена, клиентская машина может использовать этот сервер как SOCKS5-прокси. Для
проверки можно отправить запрос к заблокированному ресурсу:

```cmd
curl -v --socks5-hostname X.X.X.X:18080 https://www.youtube.com
```
